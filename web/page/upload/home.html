{{ define "upload/home.html" }}
{{ template "top" .}}

<style>
.br-link {
  color: #0d6efd;
  text-decoration: underline;
  cursor: pointer;
}
.triage-listing-table {
  width: 100%;
  table-layout: fixed;
  font-size:medium;
}
.triage-listing-table tr {
  user-select: none;
}
.triage-listing-table tr:hover td {
  background-color: #efefef;
}
#item-details button,a {
  width: 100%;
  margin: 5px 0 5px 0;
}
code {
  color: #684900;
  background-color: #fffbda;
}
</style>

<!-- header -->
<div style="display: flex; justify-content: space-between;">
  <h4>Upload and triage folder</h4>
  <button class="btn btn-outline-success" onclick="clickInputButton()">Upload file</button>
</div>
<hr />

<!-- breadcumb -->
<nav id="path" style="font-size:large; margin: 30px 0px 30px 0px; --bs-breadcrumb-divider: '>';">
</nav>

<!-- listing -->
<div class="row">
  <div class="col-md-12">
    <table class="table triage-listing-table">
      <colgroup>
        <col style="width:2%;">
        <col style="width:73%;">
        <col style="width:15%;">
        <col style="width:10%;">
      </colgroup>
      <thead>
        <th colspan="2">Name</th>
        <th>Last modified</th>
        <th>Size</th>
      </thead>
      <tbody id="triage-listing"></tbody>
    </table>
  </div>
</div>

<!-- upload form -->
<div class="row">
  <div class="col-md-12">
    <form>
      <input type="hidden" id="upload-input-path" name="path" value="" />
      <input type="file" id="upload-input-file" name="file" style="visibility:hidden" onchange="fileUpload(this)"/>
    </form>
  </div>
</div>

<!-- detail offcanvas -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="item-details">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title">Details</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body" id="item-details-content">
    ...
  </div>
</div>

<!-- import video modal -->
<div class="modal fade modal-lg" id="video-import-modal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalToggleLabel">Import video confirmation</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p>Details of the video to be imported</p>
        <p>Filename: <code id="videoImportFileName">sdfsdfs</code></p>
        <p>Located in: <code id="videoImportFilePath">sdfsdfs</code></p>
      </div>
      <div class="modal-footer">
        <div class="input-group" style="justify-content: flex-end;">
          <span class="input-group-text">Import as: </span>
          <button type="button" class="btn btn-primary" onclick="importVideoAjax('v')">Video</button>
          <button type="button" class="btn btn-primary" onclick="importVideoAjax('m')">Movie</button>
          <button type="button" class="btn btn-primary" onclick="importVideoAjax('c')">Clip</button>
        </div>
      </div>
    </div>
  </div>
</div>

<button class="btn btn-primary" data-bs-target="#exampleModalToggle" data-bs-toggle="modal">Open first modal</button>

<!-- Import as video modal -->
<div class="offcanvas offcanvas-bottom h-auto" tabindex="-1" id="importAsVideoOffCanvas" style="height: 50vh">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title">Import a video</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body">
    <div class="row">
      <div class="col-1">
      </div>
      <div class="col-4">
        <p><b>Video preview</b></p>
        <video controls class="previewVideo" style="height: 35vh; width: 100%" preload="auto"/>
      </div>
      <div class="col-6">
        <p><b>Video details</b></p>
        <div class="mb-4">
          Enter a title, select a type and import the video!
        </div>
        <div class="form-floating mb-4">
          <input type="hidden" class="video-filepath">
          <input type="text" disabled class="form-control video-filename">
          <label for="originalFilename">Original filename</label>
        </div>
         <div class="form-floating mb-4">
          <input type="text" class="form-control video-title">
          <label for="originalFilename">Video title</label>
        </div>
        <div class="input-group">
          <span class="input-group-text">Choose video type</span>
          <select class="form-select" onchange="importAsVideoButtonUpdate(this)" id="importAsVideoTypeSelect">
            <option value="x" selected>Choose...</option>
            <option value="v">Video</option>
            <option value="c">Clip</option>
            <option value="m">Movie</option>
          </select>
          <button class="btn btn-success" type="button" id="importAsVideoButton" disabled onclick="importVideoAjax()">Import</button>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- End import as video modal -->

<!-- Toast template -->
<div style="display: none">
  <div id="toastFileUploadTemplate" class="toast" role="alert" data-bs-autohide="false" style="opacity: 1; transition: opacity 1s;">
    <div class="toast-header text-white bg-primary">
      <strong class="me-auto zt-toast-title">Upload in progress</strong>
      <small class="zt-toast-subtitle">0 %</small>
      <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
    <div class="toast-body zt-toast-body">
      Upload in progress
    </div>
  </div>
</div>
<!-- End of toast template -->

<!-- Preview specific JS -->
<script>
var CURRENT_PATH='/';
function setFolder(folderName) {
  CURRENT_PATH=folderName;
  updatePath();
}

function enterFolder(folderName) {
  if (CURRENT_PATH == '/') {
    CURRENT_PATH += folderName;
  } else {
    CURRENT_PATH += '/';
    CURRENT_PATH += folderName;
  }
  updatePath();
}

function updatePath() {
  console.log('switching to: '+CURRENT_PATH);

  generateBreadcrumb();

  // reset table listing
  document.getElementById('triage-listing').innerHTML = '';

  loadFolders();
  loadFiles();
}

function generateBreadcrumb() {
  var path = CURRENT_PATH;
  pathAsArray = path.split('/');
  max = pathAsArray.length;
  progressivePath = '';

  newBr  = '<ol class="breadcrumb">';
  newBr += '<li class="breadcrumb-item';
  if (path == '/') {
    newBr += ' active">';
  } else {
    newBr += ' br-link" onclick="setFolder(\'/\')">';
  }
  newBr += 'Triage</li>';
  for (var i=0; i < max; i++) {
    folder = pathAsArray[i];
    if (folder == "") {
      continue;
    } else {
      progressivePath += '/'+folder;
    }

    newBr += '<li class="breadcrumb-item';
    if (i+1 == max) {
      newBr += ' active">';
    } else {
      newBr += ' br-link" onClick="setFolder(\''+progressivePath+'\')">';
    }
    newBr += folder+'</li>';
  }

  newBr += '</ol>';

  document.getElementById('path').innerHTML = newBr;
}

function loadFolders() {
  $.ajax('/api/upload/triage/folder', {
    method: 'POST',
    data: {
      'path': CURRENT_PATH,
    },
    xhr: function () {
      var xhr = new XMLHttpRequest();
      return xhr;
    },

    success: function (data) {
      showFolders(data.folders);
    },

    error: function (data) {
      sendToast(
        'Unable to show folders',
        '',
        'bg-warning',
        data.responseJSON.error,
      );
    },
  });
}

function loadFiles() {
  $.ajax('/api/upload/triage/file', {
    method: 'POST',
    data: {
      'path': CURRENT_PATH,
    },
    xhr: function () {
      var xhr = new XMLHttpRequest();
      return xhr;
    },

    success: function (data) {
      showFiles(data.files);
    },

    error: function (data) {
      sendToast(
        'Unable to show files',
        '',
        'bg-warning',
        data.responseJSON.error,
      );
    },
  });
}

function showFolders(folders) {
  folderEntries = '';
  Object.keys(folders).forEach(function(folder) {
    folderEntries += '<tr ondblclick="enterFolder(\''+folder+'\');">';
    folderEntries += '<td><i class="far fa-folder"></i></td>';
    folderEntries += '<td>'+folder+'</td>';
    folderEntries += '<td>â€”</td>';
    folderEntries += '<td>'+folders[folder]+' items</td>';
    folderEntries += '</tr>';
  });

  document.getElementById('triage-listing').innerHTML += folderEntries;
}

function showFiles(files) {
  fileEntries = '';
  Object.keys(files).forEach(function(file) {
    // store file infos
    fileInfo = files[file];
    fileSize = fileInfo['Size'] == 0 ? 'Empty' : humanFileSize(fileInfo['Size'], true);
    const options = { year: "numeric", month: "short", day: "numeric" };
    fileDate = new Date(fileInfo['LastModification']).toLocaleDateString(undefined, options);

    // guess filetype based on the extension
    fileType = 'unknown';
    fileIcon = 'fas fa-file';
    if (file.match(/.*\.(mp4|mkv|webm)/)) {
      fileType = 'video';
      fileIcon = 'far fa-play-circle';
    } else if (file.match(/.*\.(png|jpg|jpeg)/)) {
      fileType = 'image';
      fileIcon = 'far fa-image';
    } else if (file.match(/.*\.(zip|tar)/)) {
      fileType = 'archive';
      fileIcon = 'far fa-file-archive';
    }

    // build file path
    filePath = CURRENT_PATH == '/' ? filePath = '/'+file : CURRENT_PATH+'/'+file;

    // render files
    fileEntries += '<tr onclick="showFileDetails(\''+file+'\', \''+filePath+'\', \''+fileType+'\', \''+fileSize+'\', \''+fileDate+'\')">';
    fileEntries += '<td><i class="'+fileIcon+'"></i></td>';
    fileEntries += '<td>'+file+'</td>';
    fileEntries += '<td>'+fileDate+'</td>';
    fileEntries += '<td>'+fileSize+'</td>';
    fileEntries += '</tr>';
  });

  document.getElementById('triage-listing').innerHTML += fileEntries;
}

function clickInputButton() {
  document.getElementById('upload-input-path').value = CURRENT_PATH;
  document.getElementById('upload-input-file').click();
}

var MD5 = function(d){var r = M(V(Y(X(d),8*d.length)));return r.toLowerCase()};function M(d){for(var _,m="0123456789ABCDEF",f="",r=0;r<d.length;r++)_=d.charCodeAt(r),f+=m.charAt(_>>>4&15)+m.charAt(15&_);return f}function X(d){for(var _=Array(d.length>>2),m=0;m<_.length;m++)_[m]=0;for(m=0;m<8*d.length;m+=8)_[m>>5]|=(255&d.charCodeAt(m/8))<<m%32;return _}function V(d){for(var _="",m=0;m<32*d.length;m+=8)_+=String.fromCharCode(d[m>>5]>>>m%32&255);return _}function Y(d,_){d[_>>5]|=128<<_%32,d[14+(_+64>>>9<<4)]=_;for(var m=1732584193,f=-271733879,r=-1732584194,i=271733878,n=0;n<d.length;n+=16){var h=m,t=f,g=r,e=i;f=md5_ii(f=md5_ii(f=md5_ii(f=md5_ii(f=md5_hh(f=md5_hh(f=md5_hh(f=md5_hh(f=md5_gg(f=md5_gg(f=md5_gg(f=md5_gg(f=md5_ff(f=md5_ff(f=md5_ff(f=md5_ff(f,r=md5_ff(r,i=md5_ff(i,m=md5_ff(m,f,r,i,d[n+0],7,-680876936),f,r,d[n+1],12,-389564586),m,f,d[n+2],17,606105819),i,m,d[n+3],22,-1044525330),r=md5_ff(r,i=md5_ff(i,m=md5_ff(m,f,r,i,d[n+4],7,-176418897),f,r,d[n+5],12,1200080426),m,f,d[n+6],17,-1473231341),i,m,d[n+7],22,-45705983),r=md5_ff(r,i=md5_ff(i,m=md5_ff(m,f,r,i,d[n+8],7,1770035416),f,r,d[n+9],12,-1958414417),m,f,d[n+10],17,-42063),i,m,d[n+11],22,-1990404162),r=md5_ff(r,i=md5_ff(i,m=md5_ff(m,f,r,i,d[n+12],7,1804603682),f,r,d[n+13],12,-40341101),m,f,d[n+14],17,-1502002290),i,m,d[n+15],22,1236535329),r=md5_gg(r,i=md5_gg(i,m=md5_gg(m,f,r,i,d[n+1],5,-165796510),f,r,d[n+6],9,-1069501632),m,f,d[n+11],14,643717713),i,m,d[n+0],20,-373897302),r=md5_gg(r,i=md5_gg(i,m=md5_gg(m,f,r,i,d[n+5],5,-701558691),f,r,d[n+10],9,38016083),m,f,d[n+15],14,-660478335),i,m,d[n+4],20,-405537848),r=md5_gg(r,i=md5_gg(i,m=md5_gg(m,f,r,i,d[n+9],5,568446438),f,r,d[n+14],9,-1019803690),m,f,d[n+3],14,-187363961),i,m,d[n+8],20,1163531501),r=md5_gg(r,i=md5_gg(i,m=md5_gg(m,f,r,i,d[n+13],5,-1444681467),f,r,d[n+2],9,-51403784),m,f,d[n+7],14,1735328473),i,m,d[n+12],20,-1926607734),r=md5_hh(r,i=md5_hh(i,m=md5_hh(m,f,r,i,d[n+5],4,-378558),f,r,d[n+8],11,-2022574463),m,f,d[n+11],16,1839030562),i,m,d[n+14],23,-35309556),r=md5_hh(r,i=md5_hh(i,m=md5_hh(m,f,r,i,d[n+1],4,-1530992060),f,r,d[n+4],11,1272893353),m,f,d[n+7],16,-155497632),i,m,d[n+10],23,-1094730640),r=md5_hh(r,i=md5_hh(i,m=md5_hh(m,f,r,i,d[n+13],4,681279174),f,r,d[n+0],11,-358537222),m,f,d[n+3],16,-722521979),i,m,d[n+6],23,76029189),r=md5_hh(r,i=md5_hh(i,m=md5_hh(m,f,r,i,d[n+9],4,-640364487),f,r,d[n+12],11,-421815835),m,f,d[n+15],16,530742520),i,m,d[n+2],23,-995338651),r=md5_ii(r,i=md5_ii(i,m=md5_ii(m,f,r,i,d[n+0],6,-198630844),f,r,d[n+7],10,1126891415),m,f,d[n+14],15,-1416354905),i,m,d[n+5],21,-57434055),r=md5_ii(r,i=md5_ii(i,m=md5_ii(m,f,r,i,d[n+12],6,1700485571),f,r,d[n+3],10,-1894986606),m,f,d[n+10],15,-1051523),i,m,d[n+1],21,-2054922799),r=md5_ii(r,i=md5_ii(i,m=md5_ii(m,f,r,i,d[n+8],6,1873313359),f,r,d[n+15],10,-30611744),m,f,d[n+6],15,-1560198380),i,m,d[n+13],21,1309151649),r=md5_ii(r,i=md5_ii(i,m=md5_ii(m,f,r,i,d[n+4],6,-145523070),f,r,d[n+11],10,-1120210379),m,f,d[n+2],15,718787259),i,m,d[n+9],21,-343485551),m=safe_add(m,h),f=safe_add(f,t),r=safe_add(r,g),i=safe_add(i,e)}return Array(m,f,r,i)}function md5_cmn(d,_,m,f,r,i){return safe_add(bit_rol(safe_add(safe_add(_,d),safe_add(f,i)),r),m)}function md5_ff(d,_,m,f,r,i,n){return md5_cmn(_&m|~_&f,d,_,r,i,n)}function md5_gg(d,_,m,f,r,i,n){return md5_cmn(_&f|m&~f,d,_,r,i,n)}function md5_hh(d,_,m,f,r,i,n){return md5_cmn(_^m^f,d,_,r,i,n)}function md5_ii(d,_,m,f,r,i,n){return md5_cmn(m^(_|~f),d,_,r,i,n)}function safe_add(d,_){var m=(65535&d)+(65535&_);return(d>>16)+(_>>16)+(m>>16)<<16|65535&m}function bit_rol(d,_){return d<<_|d>>>32-_}

function createToast(path, file) {

  toastTemplate = document.getElementById('toastFileUploadTemplate');

  // create new toast
  newtoast = toastTemplate.cloneNode(true);

  div_id = 'toast_file_'+MD5(file+'/'+path);
  newtoast.id = div_id;

  // set title
  //n_title = newtoast.getElementsByClassName('zt-toast-title');
  //n_title[0].innerText = title;

  // set subtitle
  //n_subtitle = newtoast.getElementsByClassName('zt-toast-subtitle');
  //n_subtitle[0].innerText = subtitle;

  // set color
  //n_header = newtoast.getElementsByClassName('toast-header');
  //n_header[0].className += " "+title_color

  // set content
  n_content = newtoast.getElementsByClassName('zt-toast-body');
  n_content[0].innerHTML = 'Uploading of '+file;

 
  toastContainer = document.getElementById('zt-toast-container');
  toastContainer.appendChild(newtoast);
  toast = new bootstrap.Toast(newtoast, {'autohide': false});
  toast.show();
 
}

function updateToastProgress(path, file, current, max) {
  div_id = 'toast_file_'+MD5(file+'/'+path);
  toast = document.getElementById(div_id);

  value = Math.floor(current*100/max);

  // set subtitle
  n_subtitle = toast.getElementsByClassName('zt-toast-subtitle');
  n_subtitle[0].innerText = value + ' %';

  if (value == 100) {
    // set color
    n_header = toast.getElementsByClassName('toast-header');
    n_header[0].classList.remove('bg-primary');
    n_header[0].classList.add('bg-success');

    // set title
    n_title = toast.getElementsByClassName('zt-toast-title');
    n_title[0].innerText = 'Upload finished';

    loadFiles();

    // close a little bit later
    setTimeout(function() {
      $(toast).hide();
    }, 5000);
  }
}

function fileUpload(e) {
  var file = e.files[0];

  createToast(CURRENT_PATH,file.name);
  $.ajax({
    url: '/api/upload/file',
    type: 'POST',

    data: new FormData(e.form),

    cache: false,
    contentType: false,
    processData: false,

    // Custom XMLHttpRequest
    xhr: function () {
      var myXhr = $.ajaxSettings.xhr();
      if (myXhr.upload) {
        // For handling the progress of the upload
        myXhr.upload.addEventListener('progress', function (e) {
          if (e.lengthComputable) {
            updateToastProgress(CURRENT_PATH, file.name, e.loaded, e.total);
          }
        }, false);
      }
      return myXhr;
    },
    done: function() {
      updateToastProgress(CURRENT_PATH, file.name, e.loaded, e.total);
    },
  });
}

function importVideo(filename, filepath) {
  const filenameInput = window.VideoImport.querySelector('#videoImportFileName');
  filenameInput.innerText = filename;

  const filepathInput = window.VideoImport.querySelector('#videoImportFilePath');
  filepathInput.innerText = filepath;

  // display modal
  window.VideoImportModal.show();
}

function showFileDetails(fileName, filePath, fileType, fileSize, fileDate) {
  // Nice file types
  const niceFileTypes = {
    'unknown': 'Unrecognized type',
    'video': 'Video',
    'image': 'Picture',
    'archive': 'Compressed archive',
  };

  // generate canvas content - common atrributes
  canvasHTML = '<h3>File details</h3><hr />';
  canvasHTML += '<b>Name</b><p>'+fileName+'</p>';
  canvasHTML += '<b>Type</b><p>'+niceFileTypes[fileType]+'</p>';
  canvasHTML += '<b>Size</b><p>'+fileSize+'</p>';
  canvasHTML += '<b>Last modification</b><p>'+fileDate+'</p>';

  // generate canvas content - video specifics
  if (fileType == 'video') {
    canvasHTML += '<h5 style="padding-top: 50px;">Video preview</h5><hr />';
    canvasHTML += '<video controls class="previewVideo" style="width: 100%"';
    canvasHTML += 'src="/upload/preview/'+encodeURIComponent(filePath.substring(1))+'" >';
    canvasHTML += '</video>';
  }
  // generate canvas content - picture specifics
  else if (fileType == 'image') {
    canvasHTML += '<h5 style="padding-top: 50px;">Picture preview</h5><hr />';
    canvasHTML += '<img style="width: 100%"';
    canvasHTML += 'src="/upload/preview/'+encodeURIComponent(filePath.substring(1))+'" ';
    canvasHTML += '/>';
  }

  // generate canvas content - actions
  canvasHTML += '<h5 style="padding: 50px 0px 15px 0px;">Actions</h5>';

  // generate canvas content - video specific actions
  if (fileType == 'video') {
    canvasHTML += '<button class="btn btn-outline-primary" onclick="importVideo(\''+fileName+'\', \''+filePath+'\')">';
    canvasHTML += '<i class="fas fa-file-import"></i> Import</button>';
  }

  // generate canvas content - common actions
  canvasHTML += '<a class="btn btn-outline-primary" target="_blank" rel="noopener noreferrer" ';
  canvasHTML += 'href="/upload/preview/'+encodeURIComponent(filePath.substring(1))+'">';
  canvasHTML += '<i class="fas fa-download"></i> Download</a>';
  /*
   * TODO: implement deletion
   * canvasHTML += '<button class="btn btn-outline-danger"><i class="far fa-trash-alt"></i> Delete</button>';
   */

  // set content
  window.DetailPanelContent.innerHTML = canvasHTML;

  // display canvas
  window.DetailPanelOffCanvas.show();
}

/* startup */
window.onload = function() {
  generateBreadcrumb();
  setFolder(CURRENT_PATH);

  // initialize detail panel
  window.DetailPanel = document.getElementById('item-details');
  window.DetailPanelOffCanvas = new bootstrap.Offcanvas(window.DetailPanel);
  window.DetailPanelContent = document.getElementById('item-details-content');

  // pause video when hidden
  window.DetailPanel.addEventListener('hide.bs.offcanvas', event => {
    const video = DetailPanelContent.querySelector('.previewVideo');
    if (video != null) {
      video.pause();
    }
  });

  // initialize video import modal
  window.VideoImport = document.getElementById('video-import-modal');
  window.VideoImportModal = new bootstrap.Modal(window.VideoImport);
}

function importAsVideoButtonUpdate(sel) {
  const btn = document.getElementById('importAsVideoButton');
  btn.disabled = (sel.value == 'x');
}

function importVideoAjax(filetype) {
  oc = document.getElementById('importAsVideoOffCanvas');
  const filename = window.VideoImport.querySelector('#videoImportFilePath').innerText;
  const title = window.VideoImport.querySelector('#videoImportFileName').innerText;

  $.ajax('/api/video', {
    method: 'POST',
    data: {
      'name': title,
      'filename': filename,
      'type': filetype,
    },
    xhr: function () {
      var xhr = new XMLHttpRequest();
      return xhr;
    },

    success: function (data) {
      // get video id from response
      video_id = data.video_id;

      // send notification
      sendToast(
        'Import a video',
        '',
        'bg-success',
        '<a href="/video/'+video_id+'/edit" target="_blank">You can edit the video more here</a>',
      );

      // close canvas

      // remove video from view

      // move file
      $.ajax('/api/video/'+video_id+'/import', {
        method: 'POST',
        xhr: function () {
          var xhr = new XMLHttpRequest();
          return xhr;
        },

        success: function (data) {
          generateThumnail(video_id);
          sendToast(
            'Import a video',
            '',
            'bg-success',
            'Video ready',
          );

          // close modal
          window.VideoImportModal.hide();

          // close off canvas
          window.DetailPanelOffCanvas.hide();

          // refresh view
          updatePath();

        },

        error: function (data) {
          sendToast(
            'Unable to move video',
            '',
            'bg-warning',
            data.responseJSON.error,
          );
        },
      });


    },

    error: function (data) {
      sendToast(
        'Unable to import video',
        '',
        'bg-warning',
        data.responseJSON.error,
      );
    },
  });

}

function generateThumnail(video_id) {
  $.ajax('/api/video/'+video_id+'/generate-thumbnail/0', {
    method: 'POST',
    xhr: function () {
      var xhr = new XMLHttpRequest();
      return xhr;
    },
    success: function(data) {
      computeDuration(video_id);
    },
  });
}

function computeDuration(video_id) {
  $.ajax('/api/video/'+video_id+'/compute-duration', {
    method: 'POST',
    xhr: function () {
      var xhr = new XMLHttpRequest();
      return xhr;
    },
  });
}

// From: https://stackoverflow.com/a/14919494

/**
 * Format bytes as human-readable text.
 *
 * @param bytes Number of bytes.
 * @param si True to use metric (SI) units, aka powers of 1000. False to use
 *           binary (IEC), aka powers of 1024.
 * @param dp Number of decimal places to display.
 *
 * @return Formatted string.
 */
 function humanFileSize(bytes, si=false, dp=1) {
  const thresh = si ? 1000 : 1024;

  if (Math.abs(bytes) < thresh) {
    return bytes + ' B';
  }

  const units = si
    ? ['kB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB']
    : ['KiB', 'MiB', 'GiB', 'TiB', 'PiB', 'EiB', 'ZiB', 'YiB'];
  let u = -1;
  const r = 10**dp;

  do {
    bytes /= thresh;
    ++u;
  } while (Math.round(Math.abs(bytes) * r) / r >= thresh && u < units.length - 1);


  return bytes.toFixed(dp) + ' ' + units[u];
}

</script>

<!-- Footer Area -->
<footer>
    <div class="scroll-top">
        <div class="scroll-icon">
            <i class="fa fa-angle-up"></i>
        </div>
    </div>
</footer>
<!-- End Footer Area -->

{{ template "bottom" .}}
{{ end }}
